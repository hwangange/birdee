<!DOCTYPE html>
<html>
<head>
  <title>Birdee</title>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <link href='http://fonts.googleapis.com/css?family=Biryani:400,800,900|Nunito:400,700' rel='stylesheet' type='text/css'>
  <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
  <link href="css/extra.css" rel="stylesheet" media="screen">
  <style>
  html, body, #map-canvas {
    height: 100%;
    margin: 1%;
    padding: 0;
  }

  body {
    background: #accbe8 url("/img/half-tree.png") no-repeat fixed right;
  }

  .center {
    margin: auto;
    width: 100%;
  }

  #info-header {
    font-size: 1em;
    margin-top: 0.67em;
    margin-bottom: 0.67em;
    margin-left: 0;
    margin-right: 0;
    font-weight: bold;
  }

  </style>
  <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=places"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?libraries=places"></script>

  <script>
  // Note: This example requires that you consent to location sharing when
  // prompted by your browser. If you see a blank space instead of the map, this
  // is probably because you have denied permission for location sharing.

  $(document).ready(function(){
    $("#myBtn").click(function(event){
      event.preventDefault();
      //var x = $("#selected").val();
      var x = $("#selected").val();
      $("#demo").innerHTML = x;
      initialize();
      search(x);
    });
  });

  var map;
  var pos;
  var infowindow;

  function initialize() {
    var mapOptions = {
      zoom: 15
    };
    map = new google.maps.Map(document.getElementById('map-canvas'),
    mapOptions);

    // Try HTML5 geolocation
    if(navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        pos = new google.maps.LatLng(position.coords.latitude,
          position.coords.longitude);

          /*var request = {
          location: pos,
          radius: 1000,
          types: ['store']
        };*/
        map.setCenter(pos);
        var marker=new google.maps.Marker({
          position:pos,
          icon: {
            // Star
            path: 'M 0,-24 6,-7 24,-7 10,4 15,21 0,11 -15,21 -10,4 -24,-7 -6,-7 z',
            fillColor: '#ffff00',
            fillOpacity: 1,
            scale: 1/4,
            strokeColor: '#bd8d2c',
            strokeWeight: 1
          }
        });

        marker.setMap(map);
      }, function() {
        handleNoGeolocation(true);
      });
    } else {
      // Browser doesn't support Geolocation
      handleNoGeolocation(false);
    }
  }

  function handleNoGeolocation(errorFlag) {
    if (errorFlag) {
      var content = 'Error: The Geolocation service failed.';
    } else {
      var content = 'Error: Your browser doesn\'t support geolocation.';
    }

    var options = {
      map: map,
      position: new google.maps.LatLng(60, 105),
      content: content
    };

    var infowindow = new google.maps.InfoWindow(options);
    map.setCenter(options.position);
  }
  google.maps.event.addDomListener(window, 'load', initialize);

  </script>
</head>
<body bgcolor="#accbe8">
  <div class="container">
    <header class="page-header">
      <h1><b>Birdee</b> <small><i>Know the town inside out!</i></small></h1>
    </header>
    <div class="dropdown center">
      <h3><small>What are you looking for?</small></h3>
      <select name="What are you looking for?" id="selected">
        <option value="lodging">Lodging</option>
        <option value="food">Food</option>
        <option value="airport">Airport</option>
        <option value="hotel">Hotel</option>
        <option value="atm">ATM</option>
        <option value="bank">Bank</option>
        <option value="bus_station">Bus Station</option>
        <option value="taxi_stand">Taxi</option>
        <option value="train_stand">Train</option>
        <option value="cafe">Cafe</option>
        <option value="gas_station">Gas Station</option>
        <option value="clothing_store">Clothing</option>
      </select>
      <input type="submit" id="myBtn" value="Submit" class="btn btn-success btn-sm">
      <p id="demo"></p>
    </div>
    <br>

    </div>
      <script>
      </script>
      <script>
      var map;
      var pos;
      var infowindow;
      function search(text) {
        var mapOptions = {
          zoom: 15
        };
        map = new google.maps.Map(document.getElementById('map-canvas'),
        mapOptions);
        if(navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position){
            pos = new google.maps.LatLng(position.coords.latitude,
              position.coords.longitude);
            }
          );

          var request = {
            location: pos,
            radius: 1000,
            types: [String(text)]
          };

          infowindow = new google.maps.InfoWindow();
          var service = new google.maps.places.PlacesService(map);
          service.nearbySearch(request, callback);
        }

        else {
          handleNoGeolocation(false);
        }
      }

      function createMarker(place) {
        var placeLoc = place.geometry.location;

        var image = {
          url: place.icon,
          size: new google.maps.Size(71, 71),
          origin: new google.maps.Point(0, 0),
          anchor: new google.maps.Point(17, 34),
          scaledSize: new google.maps.Size(25, 25)
        };

        var marker = new google.maps.Marker({
          map: map,
          position: place.geometry.location,
          icon: image
        });
        marker.setMap(map);

        var contentString = '<h1 id="#info-header"><b>'+place.name+'</b></h1>'
          +'<p><b>Address: </b>'+place.vicinity+'</p>'
          +'<p><b>Rating: </b>'+place.rating+'/5.0</p>';

        google.maps.event.addListener(marker, 'click', function() {
          infowindow.setContent(contentString);
          infowindow.open(map, this);
        });
      }

      function callback(results, status) {
        if (status == google.maps.places.PlacesServiceStatus.OK) {
          for (var i = 0; i < results.length; i++) {
            createMarker(results[i]);
          }
        }
      }

      function loadScript() {
        var script = document.createElement("script");
        script.src = "http://maps.googleapis.com/maps/api/js?callback=initialize";
        document.body.appendChild(script);
      }

      // window.onload = loadScript;
      </script>
      <div class="container" id="map-canvas"></div>
  </body>
  </html>
